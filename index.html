<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PostMyFreight — Where brokers and truckers meet.</title>
<meta name="description" content="Pre-register to the lightweight directory connecting independent brokers and drivers." />
<style>
  :root{--bg:#0f172a;--card:#0b1324;--ink:#e5e7eb;--muted:#9ca3af;--border:#1f2937;--accent:#22c55e;--danger:#ef4444;--focus:#93c5fd;}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Inter,Roboto,Arial,sans-serif;color:var(--ink);
    background:radial-gradient(900px 500px at 80% -10%, rgba(96,165,250,.18), transparent 60%),
               radial-gradient(700px 400px at 10% -10%, rgba(34,197,94,.18), transparent 60%),var(--bg);
    display:grid;place-items:center;padding:20px}
  .wrap{width:100%;max-width:820px}
  .hero{text-align:center;margin-bottom:18px}
  .badge{display:inline-block;padding:6px 10px;border:1px solid var(--border);border-radius:999px;color:var(--muted);font-size:.8rem;background:rgba(255,255,255,.02)}
  h1{margin:12px 0 6px;font-size:clamp(28px,4vw,40px)}
  .sub{color:var(--muted);margin:0 auto 6px;max-width:720px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01) 30%),var(--card);
        border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 12px 30px rgba(0,0,0,.35)}
  .stepper{display:flex;gap:8px;margin-bottom:10px}
  .pill{flex:1;text-align:center;font-weight:600;border:1px solid var(--border);border-radius:999px;padding:8px 10px;color:var(--muted)}
  .pill.active{color:var(--ink);border-color:#1d4ed8;background:rgba(96,165,250,.12)}
  form{display:grid;gap:12px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media (max-width:720px){.row{grid-template-columns:1fr}}
  label{display:block;margin-bottom:6px;color:#cbd5e1;font-size:.92rem}
  input,select,textarea{width:100%;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0a1020;color:var(--ink);outline:none}
  textarea{min-height:92px;resize:vertical}
  input:focus,select:focus,textarea:focus{border-color:var(--focus);box-shadow:0 0 0 3px rgba(147,197,253,.15)}
  .seg{display:flex;gap:8px;background:#0a1020;border:1px solid var(--border);border-radius:12px;padding:6px}
  .seg button{flex:1;padding:10px 12px;border:1px solid transparent;border-radius:10px;background:transparent;color:var(--ink);cursor:pointer;font-weight:600}
  .seg button[aria-pressed="true"]{background:rgba(96,165,250,.14);border-color:#1d4ed8}
  .hint{color:var(--muted);font-size:.85rem}
  .consent{display:flex;align-items:center;gap:10px}
  .consent input{width:18px;height:18px;accent-color:var(--accent)}
  .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .btn{background:linear-gradient(180deg,#22c55e,#16a34a);color:#fff;border:none;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer}
  .btn.secondary{background:transparent;color:var(--muted);border:1px solid var(--border)}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .hide{display:none}
  .error{color:var(--danger);font-size:.95rem}
  .success{border:1px solid #14532d;background:rgba(34,197,94,.08);padding:12px;border-radius:12px;color:#bbf7d0}
  .hr{height:1px;background:var(--border);margin:6px 0}
  .footer{color:var(--muted);font-size:.85rem;text-align:center;margin-top:10px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <span class="badge">PostMyFreight.com</span>
      <h1>Where brokers and truckers meet.</h1>
      <p class="sub">A lightweight directory for independents. Claim your spot in two quick steps.</p>
    </div>

    <div class="card">
      <div class="stepper">
        <div class="pill active" id="pill1">Step 1 · Basics</div>
        <div class="pill" id="pill2">Step 2 · Details</div>
      </div>

      <form id="preRegForm" novalidate>
        <!-- STEP 1 -->
        <section id="step1">
          <div class="row">
            <div>
              <label for="country">Country</label>
              <select id="country" name="country">
                <option value="CA" selected>Canada</option>
                <option value="US">Unitied States</option>
              </select>
            </div>
            <div>
              <label>Role</label>
              <div class="seg" role="group" aria-label="Choose your role">
                <button type="button" id="btnBroker" aria-pressed="false">Broker</button>
                <button type="button" id="btnDriver" aria-pressed="false">Driver</button>
              </div>
              <div id="roleError" class="error hide">Select Broker or Driver.</div>
            </div>
          </div>

          <div class="row">
            <div>
              <label for="email">Email *</label>
              <input id="email" name="email" type="email" placeholder="you@company.com" autocomplete="email" required />
            </div>
            <div>
              <label for="phone">Phone (optional)</label>
              <input id="phone" name="phone" type="tel" placeholder="+1 555 123 4567" autocomplete="tel" />
            </div>
          </div>

          <div class="row">
            <div>
              <label for="stateprov">State / Province</label>
              <input id="stateprov" name="stateprov" type="text" placeholder="TX · ON · QC" />
            </div>
            <div class="consent">
              <input type="checkbox" id="consent" />
              <label for="consent" class="hint">Okay to contact me about my profile and early access.</label>
            </div>
          </div>

          <div class="actions">
            <button class="btn" id="toStep2" type="button">Continue</button>
            <span class="hint">No password today — you’ll set one at launch.</span>
          </div>
          <div class="hr"></div>
        </section>

        <!-- STEP 2 -->
        <section id="step2" class="hide">
          <!-- Broker fields -->
          <div id="brokerFields" class="hide">
            <div class="row">
              <div>
                <label for="company">Company</label>
                <input id="company" name="company" type="text" placeholder="Acme Logistics" />
              </div>
              <div id="idWrapUS">
                <label for="mc">MC / DOT (optional)</label>
                <input id="mc" name="mc" type="text" placeholder="MC 123456 · DOT 1234567" />
              </div>
              <div id="idWrapCA" class="hide">
                <label for="nsc_broker">NSC / Provincial # (optional)</label>
                <input id="nsc_broker" name="nsc_broker" type="text" placeholder="e.g., NSC (AB) · CVOR (ON)" />
              </div>
            </div>

            <div class="row">
              <div>
                <label for="scac">SCAC (optional)</label>
                <input id="scac" name="scac" type="text" placeholder="e.g., ABCD" />
              </div>
              <div>
                <label for="pref_equipment">Preferred equipment</label>
                <input id="pref_equipment" name="pref_equipment" type="text" placeholder="Dry Van, Reefer, Flatbed" />
              </div>
            </div>

            <div>
              <label for="freight_types">Typical freight (optional)</label>
              <input id="freight_types" name="freight_types" type="text" placeholder="produce, steel, general freight" />
            </div>

            <div>
              <label for="lanes">Primary lanes (e.g., TX→FL · ON↔QC)</label>
              <textarea id="lanes" name="lanes" placeholder="List a few lanes you cover"></textarea>
            </div>
          </div>

          <!-- Driver fields -->
          <div id="driverFields" class="hide">
            <div class="row">
              <div>
                <label for="name">Your name</label>
                <input id="name" name="name" type="text" placeholder="First Last" />
              </div>
              <div>
                <label for="equipment">Equipment</label>
                <select id="equipment" name="equipment">
                  <option value="">Select equipment</option>
                  <option>Dry Van</option><option>Reefer</option><option>Flatbed</option>
                  <option>Hotshot</option><option>Step Deck</option><option>Power Only</option>
                  <option>Super-B</option><option value="Other">Other</option>
                </select>
              </div>
            </div>

            <div id="equipmentOtherWrap" class="hide">
              <label for="equipmentOther">Describe equipment</label>
              <input id="equipmentOther" name="equipmentOther" type="text" placeholder="e.g., Conestoga, RGN, turnpike doubles" />
            </div>

            <div class="row">
              <div>
                <label for="homebase">Home base</label>
                <input id="homebase" name="homebase" type="text" placeholder="Dallas, TX · Brampton, ON" />
              </div>
              <div>
                <label for="radius" id="radiusLabel">Radius (miles)</label>
                <select id="radius" name="radius">
                  <option value="">Select</option>
                  <option>100</option><option>250</option><option>500</option><option>Nationwide</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div>
                <label for="nsc_driver">NSC / Provincial # (optional)</label>
                <input id="nsc_driver" name="nsc_driver" type="text" placeholder="e.g., CVOR (ON), NSC (AB)" />
              </div>
              <div>
                <label for="years_exp">Years of experience</label>
                <select id="years_exp" name="years_exp">
                  <option value="">Select</option>
                  <option>&lt;1</option><option>1-2</option><option>3-5</option><option>6-10</option><option>10+</option>
                </select>
              </div>
            </div>

            <div class="row">
              <div>
                <label for="driver_company">Company / DBA (optional)</label>
                <input id="driver_company" name="driver_company" type="text" placeholder="Hagenson Transport LLC" />
              </div>
              <div>
                <label for="leased_to">Leased to carrier (optional)</label>
                <input id="leased_to" name="leased_to" type="text" placeholder="ABC Logistics (MC ######)" />
              </div>
            </div>

            <div class="consent">
              <input type="checkbox" id="insured" />
              <label for="insured" class="hint">I have active cargo/liability insurance</label>
            </div>
          </div>

          <div id="formError" class="error hide"></div>

          <div class="actions">
            <button class="btn secondary" id="backTo1" type="button">Back</button>
            <button class="btn" id="submitBtn" type="submit">Claim My Spot</button>
          </div>
        </section>

        <!-- Honeypot -->
        <div class="hide">
          <label for="website">Website (leave blank)</label>
          <input id="website" name="website" type="text" autocomplete="off" />
        </div>
      </form>

      <!-- Thank-you state (shown after successful submit) -->
      <div id="thankYou" class="success hide" style="margin-top:12px">
        <h3 style="margin:0 0 6px">Thanks — your spot is saved.</h3>
        <p class="hint" style="margin:0">We’ll email you when the directory is live.</p>
      </div>
    </div>

    <p class="footer">
      Questions? Email <a href="mailto:hello@postmyfreight.com">hello@postmyfreight.com</a>
    </p>
  </div>

  <!-- Supabase client -->
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const USE_SUPABASE = true;
    const SUPABASE_URL = "https://gmtvmcywfvbgbqulmhlw.supabase.co";              // e.g., https://xxxxx.supabase.co 
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtdHZtY3l3ZnZiZ2JxdWxtaGx3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0Njc3NzQsImV4cCI6MjA3NDA0Mzc3NH0.gWoasQWA6nzmH2ZrFtl6YcRnEEXhF5VaXpJVUYJaqvI";        // public anon key
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
  </script>

  <script>
    (function(){
      const pill1=document.getElementById('pill1'), pill2=document.getElementById('pill2');
      const step1=document.getElementById('step1'), step2=document.getElementById('step2');
      const toStep2=document.getElementById('toStep2'), backTo1=document.getElementById('backTo1');
      const btnBroker=document.getElementById('btnBroker'), btnDriver=document.getElementById('btnDriver');
      const brokerFields=document.getElementById('brokerFields'), driverFields=document.getElementById('driverFields');
      const roleError=document.getElementById('roleError');
      const form=document.getElementById('preRegForm'), formError=document.getElementById('formError');
      const submitBtn=document.getElementById('submitBtn');
      const thankYou=document.getElementById('thankYou');

      const equipmentSelect=document.getElementById('equipment'), equipmentOtherWrap=document.getElementById('equipmentOtherWrap'), equipmentOtherInput=document.getElementById('equipmentOther');

      const countrySelect=document.getElementById('country'), idWrapUS=document.getElementById('idWrapUS'), idWrapCA=document.getElementById('idWrapCA'), radiusLabel=document.getElementById('radiusLabel');

      const SUPABASE_TABLE='preregistrations';
      let role=null;

      function setRole(next){
        role=next;
        btnBroker.setAttribute('aria-pressed', next==='broker');
        btnDriver.setAttribute('aria-pressed', next==='driver');
        brokerFields.classList.toggle('hide', next!=='broker');
        driverFields.classList.toggle('hide', next!=='driver');
        roleError.classList.add('hide');
      }

      function applyCountryUI(){
        const isCA=countrySelect.value==='CA';
        idWrapUS.classList.toggle('hide', isCA);
        idWrapCA.classList.toggle('hide', !isCA);
        radiusLabel.textContent=isCA?'Radius (km)':'Radius (miles)';
      }

      function gotoStep2(){
        const email=document.getElementById('email').value.trim();
        if(!role){ roleError.classList.remove('hide'); return; }
        if(!email){ alert('Please enter a valid email.'); return; }
        step1.classList.add('hide'); step2.classList.remove('hide');
        pill1.classList.remove('active'); pill2.classList.add('active');
        window.scrollTo({top:0,behavior:'smooth'});
      }
      function backStep1(){ step2.classList.add('hide'); step1.classList.remove('hide'); pill2.classList.remove('active'); pill1.classList.add('active'); window.scrollTo({top:0,behavior:'smooth'}); }

      btnBroker.addEventListener('click',()=>setRole('broker'));
      btnDriver.addEventListener('click',()=>setRole('driver'));
      toStep2.addEventListener('click',gotoStep2);
      backTo1.addEventListener('click',backStep1);
      countrySelect.addEventListener('change',applyCountryUI); applyCountryUI();

      if(equipmentSelect){
        equipmentSelect.addEventListener('change',()=>{
          const isOther=equipmentSelect.value==='Other';
          equipmentOtherWrap.classList.toggle('hide', !isOther);
          if(!isOther) equipmentOtherInput.value='';
        });
      }

      form.addEventListener('submit', async (e)=>{
        e.preventDefault(); formError.classList.add('hide');

        // honeypot
        if(document.getElementById('website').value.trim()!==''){
          form.classList.add('hide'); thankYou.classList.remove('hide'); return;
        }

        submitBtn.disabled=true; submitBtn.textContent='Submitting…';

        const country=countrySelect.value;
        const payload={
          country,
          stateprov: document.getElementById('stateprov').value.trim() || null,
          role,
          email: document.getElementById('email').value.trim(),
          phone: document.getElementById('phone').value.trim() || null,
          consent: document.getElementById('consent').checked || false,
          ts: new Date().toISOString()
        };

        if(role==='broker'){
          payload.company = document.getElementById('company').value.trim() || null;
          if(country==='CA'){
            payload.nsc = document.getElementById('nsc_broker').value.trim() || null;
            payload.mc = null;
          } else {
            payload.mc = document.getElementById('mc').value.trim() || null;
            payload.nsc = null;
          }
          payload.scac = document.getElementById('scac').value.trim() || null;
          payload.pref_equipment = document.getElementById('pref_equipment').value.trim() || null;
          payload.freight_types = document.getElementById('freight_types').value.trim() || null;
          payload.lanes = document.getElementById('lanes').value.trim() || null;
        } else {
          payload.name = document.getElementById('name').value.trim() || null;
          let eq = equipmentSelect.value || null;
          if(eq==='Other'){ const d = equipmentOtherInput.value.trim(); eq = d ? `Other (${d})` : 'Other'; }
          payload.equipment = eq;
          payload.homebase = document.getElementById('homebase').value.trim() || null;
          payload.radius = document.getElementById('radius').value || null; // numeric or 'Nationwide'
          payload.nsc = document.getElementById('nsc_driver').value.trim() || null;
          payload.years_exp = document.getElementById('years_exp').value || null;
          payload.insured = document.getElementById('insured').checked || false;
          payload.driver_company = document.getElementById('driver_company').value.trim() || null;
          payload.leased_to = document.getElementById('leased_to').value.trim() || null;
        }

        try{
          if(USE_SUPABASE){
            const { error } = await sb.from(SUPABASE_TABLE).insert([payload]);
            if(error) throw error;
          } else {
            const res = await fetch('/api/pre-register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
            if(!res.ok) throw new Error('Network response was not ok');
          }
          // Show thank-you state
          form.classList.add('hide');
          thankYou.classList.remove('hide');
          window.scrollTo({top:0,behavior:'smooth'});
        }catch(err){
          formError.textContent='Something went wrong. Please try again.';
          formError.classList.remove('hide');
          console.error(err);
        }finally{
          submitBtn.disabled=false; submitBtn.textContent='Claim My Spot';
        }
      });
    })();
  </script>
</body>
</html>
