<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FindMyFreight — Where brokers and truckers meet.</title>
  <meta name="description" content="Pre-register to the lightweight directory that connects independent brokers and drivers without the noise or high costs." />
  <style>
    :root {
      --bg:#0f172a; --card:#111827; --text:#e5e7eb; --muted:#9ca3af; --accent:#22c55e;
      --border:#1f2937; --input:#0b1220; --focus:#93c5fd; --danger:#ef4444;
    }
    html,body{height:100%}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background: radial-gradient(1000px 600px at 80% -10%, rgba(96,165,250,.18), transparent 60%),
                  radial-gradient(800px 500px at 10% -10%, rgba(34,197,94,.18), transparent 60%),
                  var(--bg);
      color:var(--text); display:grid; place-items:center; padding:24px;
    }
    .wrap{width:100%; max-width:840px}
    .hero{text-align:center; margin-bottom:24px}
    .badge{display:inline-block; font-size:.78rem; color:var(--muted); border:1px solid var(--border);
      border-radius:999px; padding:6px 12px; background:rgba(255,255,255,.02)}
    h1{font-size:clamp(28px,4vw,40px); margin:12px 0 6px}
    .sub{color:var(--muted); font-size:clamp(14px,2.2vw,16px); max-width:720px; margin:0 auto 12px}
    .cred{color:var(--muted); font-size:.9rem; margin-top:6px}

    .card{background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01) 30%), var(--card);
      border:1px solid var(--border); border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.35)}

    form{display:grid; gap:14px}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    @media (max-width:720px){ .row{grid-template-columns:1fr} }
    label{display:block; font-size:.92rem; color:#cbd5e1; margin-bottom:6px}

    input, select, textarea{
      width:100%; box-sizing:border-box; padding:12px; border-radius:10px;
      border:1px solid var(--border); background:var(--input); color:var(--text); outline:none;
    }
    textarea{min-height:96px; resize:vertical}
    input:focus, select:focus, textarea:focus{border-color:var(--focus); box-shadow:0 0 0 3px rgba(147,197,253,.15)}

    .seg{display:flex; gap:10px; background:var(--input); padding:6px; border-radius:12px; border:1px solid var(--border)}
    .seg button{flex:1; padding:12px 14px; background:transparent; color:var(--text); border:1px solid transparent;
      border-radius:10px; cursor:pointer; font-weight:600}
    .seg button[aria-pressed="true"]{background:rgba(96,165,250,.15); border-color:#1d4ed8}

    .hint{color:var(--muted); font-size:.85rem}
    .error{color:var(--danger); font-size:.9rem}
    .success{border:1px solid #14532d; background:rgba(34,197,94,.08); padding:14px; border-radius:12px; color:#bbf7d0}
    .actions{display:flex; align-items:center; gap:12px; flex-wrap:wrap}
    .btn{background:linear-gradient(180deg, #22c55e, #16a34a); color:#fff; border:none; border-radius:12px; padding:12px 18px; font-weight:700; cursor:pointer}
    .btn:disabled{opacity:.6; cursor:not-allowed}
    .btn-secondary{background:transparent; color:var(--muted); border:1px solid var(--border); border-radius:12px; padding:10px 14px}
    .foot{color:var(--muted); font-size:.85rem; margin-top:8px}
    .hide{display:none}

    /* ✅ Aligned consent row */
    .consent{display:flex; align-items:center; gap:10px; padding:8px 0}
    .consent input[type="checkbox"]{width:18px; height:18px; accent-color:#22c55e}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="hero">
      <span class="badge">FindMyFreight.com</span>
      <h1>Where brokers and truckers meet.</h1>
      <p class="sub">We’re building a lightweight directory to connect independent brokers and drivers without the noise or high costs.</p>
      <p class="cred">Already indexing <strong>100,000+</strong> public carriers and brokers from FMCSA data. Claim your spot below.</p>
    </div>

    <div class="card">
      <form id="preRegForm" novalidate>
        <!-- Role selector -->
        <div>
          <label>Who are you?</label>
          <div class="seg" role="group" aria-label="Choose your role">
            <button type="button" id="btnBroker" aria-pressed="false">Broker</button>
            <button type="button" id="btnDriver" aria-pressed="false">Driver</button>
          </div>
          <div id="roleError" class="error hide">Please choose Broker or Driver.</div>
        </div>

        <!-- Common -->
        <div class="row">
          <div>
            <label for="email">Email <span aria-hidden="true">*</span></label>
            <input id="email" name="email" type="email" placeholder="you@company.com" autocomplete="email" required />
          </div>
          <div>
            <label for="phone">Phone (optional)</label>
            <input id="phone" name="phone" type="tel" placeholder="+1 555 123 4567" autocomplete="tel" />
            <div class="hint">We may send a one-time SMS when your profile is ready.</div>
          </div>
        </div>

        <!-- Broker fields -->
        <div id="brokerFields" class="hide">
          <div class="row">
            <div>
              <label for="company">Company Name</label>
              <input id="company" name="company" type="text" placeholder="Acme Logistics LLC" />
            </div>
            <div>
              <label for="mc">MC / DOT # (optional)</label>
              <input id="mc" name="mc" type="text" placeholder="MC 123456 / DOT 1234567" />
            </div>
          </div>
          <div>
            <label for="lanes">Primary Lanes (e.g., TX → FL, Midwest regional)</label>
            <textarea id="lanes" name="lanes" placeholder="List a few lanes you cover regularly"></textarea>
          </div>
        </div>

        <!-- Driver fields -->
        <div id="driverFields" class="hide">
          <div class="row">
            <div>
              <label for="name">Your Name</label>
              <input id="name" name="name" type="text" placeholder="First Last" />
            </div>
            <div>
              <label for="equipment">Equipment Type</label>
              <select id="equipment" name="equipment">
                <option value="">Select equipment</option>
                <option>Dry Van</option>
                <option>Reefer</option>
                <option>Flatbed</option>
                <option>Hotshot</option>
                <option>Step Deck</option>
                <option>Power Only</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <!-- ✅ Shown only when "Other" is selected -->
          <div id="equipmentOtherWrap" class="hide">
            <label for="equipmentOther">Please describe your equipment</label>
            <input id="equipmentOther" name="equipmentOther" type="text" placeholder="e.g., Conestoga, RGN, special permits" />
          </div>

          <div class="row">
            <div>
              <label for="homebase">Home Base (City, State/Province)</label>
              <input id="homebase" name="homebase" type="text" placeholder="Dallas, TX" />
            </div>
            <div>
              <label for="radius">Operating Radius</label>
              <select id="radius" name="radius">
                <option value="">Select radius</option>
                <option>100 miles</option>
                <option>250 miles</option>
                <option>500 miles</option>
                <option>Nationwide</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Consent (aligned) + Honeypot -->
        <div class="consent">
          <input type="checkbox" id="consent" />
          <label for="consent" class="hint">I agree to be contacted about my profile and early access.</label>
        </div>
        <div class="hide">
          <label for="website">Website (leave blank)</label>
          <input id="website" name="website" type="text" autocomplete="off" />
        </div>

        <div id="formError" class="error hide"></div>
        <div id="formSuccess" class="success hide">Thanks—your spot is saved. We’ll email you when the directory is live.</div>

        <div class="actions">
          <button class="btn" id="submitBtn" type="submit">Claim My Spot</button>
          <button class="btn-secondary" type="button" id="previewBtn">Preview fields for other role</button>
          <span class="foot">No password today. You’ll set one when you claim your profile at launch.</span>
        </div>
      </form>
    </div>
    <p class="foot" style="text-align:center; margin-top:14px">
      Questions? Email <a href="mailto:hello@findmyfreight.com">hello@findmyfreight.com</a>
    </p>
  </div>

  <!-- Optional: Supabase client (uncomment & fill values to use) -->
  <!--
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    const USE_SUPABASE = true;
    const SUPABASE_URL = "https://gmtvmcywfvbgbqulmhlw.supabase.co";
    const SUPABASE_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdtdHZtY3l3ZnZiZ2JxdWxtaGx3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg0Njc3NzQsImV4cCI6MjA3NDA0Mzc3NH0.gWoasQWA6nzmH2ZrFtl6YcRnEEXhF5VaXpJVUYJaqvI";
    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);
  </script>
  -->
  <script>
    (function(){
      const btnBroker = document.getElementById('btnBroker');
      const btnDriver = document.getElementById('btnDriver');
      const brokerFields = document.getElementById('brokerFields');
      const driverFields = document.getElementById('driverFields');
      const roleError = document.getElementById('roleError');
      const formError = document.getElementById('formError');
      const formSuccess = document.getElementById('formSuccess');
      const form = document.getElementById('preRegForm');
      const submitBtn = document.getElementById('submitBtn');
      const previewBtn = document.getElementById('previewBtn');

      const equipmentSelect = document.getElementById('equipment');
      const equipmentOtherWrap = document.getElementById('equipmentOtherWrap');
      const equipmentOtherInput = document.getElementById('equipmentOther');

      // Flip this to true if you uncommented the Supabase block above
      const USE_SUPABASE = false; // set to true if using Supabase snippet
      const SUPABASE_TABLE = 'preregistrations';

      let role = null; // 'broker' | 'driver'

      function setRole(next){
        role = next;
        btnBroker.setAttribute('aria-pressed', next === 'broker');
        btnDriver.setAttribute('aria-pressed', next === 'driver');
        brokerFields.classList.toggle('hide', next !== 'broker');
        driverFields.classList.toggle('hide', next !== 'driver');
        roleError.classList.add('hide');
        formError.classList.add('hide');
      }
      btnBroker.addEventListener('click', () => setRole('broker'));
      btnDriver.addEventListener('click', () => setRole('driver'));
      previewBtn.addEventListener('click', () => { if (role==='broker') setRole('driver'); else setRole('broker'); });

      // ✅ Show "Other equipment" text field when selected
      if (equipmentSelect){
        equipmentSelect.addEventListener('change', () => {
          const isOther = equipmentSelect.value === 'Other';
          equipmentOtherWrap.classList.toggle('hide', !isOther);
          if (!isOther) equipmentOtherInput.value = '';
        });
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        formError.classList.add('hide');
        formSuccess.classList.add('hide');

        if (!role){
          roleError.classList.remove('hide'); return;
        }
        const email = document.getElementById('email').value.trim();
        if (!email){
          formError.textContent = 'Please enter a valid email.';
          formError.classList.remove('hide'); return;
        }
        // honeypot
        if (document.getElementById('website').value.trim() !== ''){
          formSuccess.classList.remove('hide'); form.reset(); setRole(null); return;
        }

        submitBtn.disabled = true; submitBtn.textContent = 'Submitting…';

        // Build payload
        const payload = {
          role,
          email,
          phone: document.getElementById('phone').value.trim() || null,
          consent: document.getElementById('consent').checked || false,
          ts: new Date().toISOString()
        };
        if (role === 'broker'){
          payload.company = document.getElementById('company').value.trim() || null;
          payload.mc = document.getElementById('mc').value.trim() || null;
          payload.lanes = document.getElementById('lanes').value.trim() || null;
        } else {
          payload.name = document.getElementById('name').value.trim() || null;
          let eq = document.getElementById('equipment').value || null;
          if (eq === 'Other'){
            const detail = equipmentOtherInput.value.trim();
            eq = detail ? `Other (${detail})` : 'Other';
          }
          payload.equipment = eq;
          payload.homebase = document.getElementById('homebase').value.trim() || null;
          payload.radius = document.getElementById('radius').value || null;
        }

        try {
          if (USE_SUPABASE && window.sb){
            const { error } = await sb.from(SUPABASE_TABLE).insert([payload]);
            if (error) throw error;
          } else {
            // Fallback: POST to your endpoint (replace with your URL)
            const res = await fetch('/api/pre-register', {
              method:'POST', headers:{'Content-Type':'application/json'},
              body: JSON.stringify(payload)
            });
            if (!res.ok) throw new Error('Network response was not ok');
          }
          formSuccess.classList.remove('hide');
          form.reset(); setRole(null);
          // Hide "Other" field just in case
          equipmentOtherWrap.classList.add('hide');
        } catch(err){
          formError.textContent = 'Something went wrong. Please try again.';
          formError.classList.remove('hide');
          console.error(err);
        } finally {
          submitBtn.disabled = false; submitBtn.textContent = 'Claim My Spot';
        }
      });
    })();
  </script>
</body>
</html>
